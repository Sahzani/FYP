<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>iAttend - Programs</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { font-family:'Poppins', sans-serif; margin:0; background:#f4f4f4; }
    header { height:60px; background:#fff; padding:0 20px; display:flex; align-items:center; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
    .main-content { padding:80px 30px; }
    table { width:100%; border-collapse:collapse; background:#fff; border-radius:8px; overflow:hidden; box-shadow:0 8px 20px rgba(0,0,0,0.08); }
    th, td { padding:12px; text-align:left; border-bottom:1px solid #ddd; }
    th { background:#f8f7ff; }
    .action-btn { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; margin-right:5px; color:white; }
    .edit-btn { background:#1e90ff; }
    .delete-btn { background:#ff4c4c; }
    .upload-btn { background:#28a745; }
    .modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
    .modal.show { display:flex; }
    .modal-content { background:#fff; border-radius:12px; width:90%; max-width:400px; overflow:hidden; }
    .modal-header { background:#1e90ff; color:#fff; padding:15px; font-weight:600; display:flex; justify-content:space-between; align-items:center; }
    .modal-body { padding:20px; }
    .modal input { width:100%; padding:10px; margin-bottom:12px; border-radius:8px; border:1px solid #ccc; }
    .modal-buttons { text-align:right; margin-top:10px; }
    .modal button { padding:10px 16px; border:none; border-radius:8px; cursor:pointer; font-weight:500; margin-left:10px; }
    .save-btn { background:#1e90ff; color:white; }
    .cancel-btn { background:#ccc; color:#000; }
  </style>
</head>
<body>

<header>
  <h1>iAttend Admin - Programs</h1>
</header>

<div class="main-content">
  <h2>Programs</h2>
  <div style="display:flex; justify-content:flex-end; gap:10px; margin-bottom:15px;">
    <button class="action-btn edit-btn" onclick="openAddModal()"><i class="fas fa-plus"></i> Add Program</button>
    <button class="action-btn upload-btn" onclick="openUploadModal()"><i class="fas fa-file-csv"></i> Upload CSV</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Program Name</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for program in programs %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ program.programName }}</td>
        <td>
          <button class="action-btn edit-btn" onclick="openEditModal('{{ program.docId }}','{{ program.programName }}')">Edit</button>
          <button class="action-btn delete-btn" onclick="openDeleteModal('{{ program.docId }}')">Delete</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Add/Edit Program Modal -->
<div id="programModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <span id="modalTitle">Add Program</span>
      <span class="close" onclick="closeModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="programForm" method="POST" action="{{ url_for('admin_program_save') }}">
        <input type="hidden" name="programId" id="formProgramId">
        <label>Program Name</label>
        <input type="text" name="programName" id="formProgramName" required>
        <div class="modal-buttons">
          <button type="submit" class="save-btn">Save</button>
          <button type="button" class="cancel-btn" onclick="closeModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Upload CSV Modal -->
<div id="uploadModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <span>Upload Programs CSV</span>
      <span class="close" onclick="closeUploadModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="uploadForm" method="POST" action="{{ url_for('admin_program_upload') }}" enctype="multipart/form-data">
        <label>Select CSV File</label>
        <input type="file" name="csv_file" accept=".csv" required>
        <div class="modal-buttons">
          <button type="submit" class="save-btn">Upload</button>
          <button type="button" class="cancel-btn" onclick="closeUploadModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Program Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">Delete Program</div>
    <div class="modal-body">
      <p id="deleteModalBody"></p>
      <form id="deleteForm" method="POST">
        <div class="modal-buttons">
          <button type="submit" class="save-btn">Delete</button>
          <button type="button" class="cancel-btn" onclick="closeDeleteModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function openAddModal(){
  document.getElementById('modalTitle').innerText = "Add Program";
  document.getElementById('formProgramId').value = "";
  document.getElementById('formProgramName').value = "";
  document.getElementById('programModal').classList.add('show');
}

function openEditModal(id,name){
  document.getElementById('modalTitle').innerText = "Edit Program";
  document.getElementById('formProgramId').value = id;
  document.getElementById('formProgramName').value = name;
  document.getElementById('programModal').classList.add('show');
}

function closeModal(){ document.getElementById('programModal').classList.remove('show'); }

function openUploadModal(){ document.getElementById('uploadModal').classList.add('show'); }
function closeUploadModal(){ document.getElementById('uploadModal').classList.remove('show'); }

function openDeleteModal(id){
  document.getElementById('deleteModalBody').innerText = "Are you sure you want to delete this program?";
  document.getElementById('deleteForm').action = "/admin/program/delete/" + id;
  document.getElementById('deleteModal').classList.add('show');
}
function closeDeleteModal(){ document.getElementById('deleteModal').classList.remove('show'); }
</script>

</body>
</html>
