<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>iAttend - Schedules</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
* {margin:0;padding:0;box-sizing:border-box;}
html, body {height:100%;font-family:'Poppins',sans-serif;background:linear-gradient(75.18deg,#FFE5B4 36.63%,#F5EEDC 92.2%);}
header{position:fixed;top:0;left:0;right:0;height:60px;background:#fff;box-shadow:0 2px 20px rgba(1,41,112,0.1);display:flex;align-items:center;padding:0 20px;font-family:'Nunito',sans-serif;font-weight:700;font-size:26px;color:#212529;z-index:1002;}
#menu-toggle{font-size:28px;margin-right:15px;cursor:pointer;}
.header-content{width:100%;display:flex;justify-content:space-between;align-items:center;}
.user-info{display:flex;align-items:center;gap:15px;padding:0 20px;border-radius:8px;cursor:pointer;}
.user-info img{width:36px;height:36px;border-radius:50%;object-fit:cover;}
.user-info span{font-size:16px;font-weight:600;color:#444;}
.sidebar{position:fixed;top:0;left:0;width:240px;height:100%;background:linear-gradient(180deg,#FFEED3 0%,#FFEED3 100%);padding-top:60px;transition:width 0.4s ease;z-index:1001;overflow-y:auto;box-shadow:2px 0 15px rgba(1,41,112,0.08);border-radius:0 16px 16px 0;}
.sidebar.collapsed{width:70px;}
.sidebar-section{margin-bottom:25px;}
.sidebar-link{display:flex;align-items:center;gap:12px;padding:12px 20px;margin-bottom:5px;border-radius:8px;font-size:15px;font-weight:500;color:#1A237E;text-decoration:none;white-space:nowrap;}
.sidebar-link.active{background:rgba(255,255,255,0.7);color:#4154F1;font-weight:600;}
.main-content{margin-left:260px;padding:100px 30px 30px;height:100vh;overflow-y:auto;transition:margin-left 0.4s;}
.sidebar.collapsed ~ .main-content{margin-left:80px;}
.card{background:#fff;padding:1.5rem;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.08);margin-bottom:20px;}
table{width:100%;border-collapse:collapse;font-family:'Poppins',sans-serif;font-size:14px;}
th{background-color:#f8f7ff;text-align:left;padding:12px;font-weight:500;}
td{padding:12px;border-top:1px solid #ddd;}
button.action-btn{padding:5px 10px;border:none;border-radius:5px;cursor:pointer;margin-right:5px;color:white;}
button.edit-btn{background:#1e90ff;}
button.delete-btn{background:#ff4c4c;}
.modal{display:none;position:fixed;z-index:10000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.5);justify-content:center;align-items:center;}
.modal.show{display:flex;}
.modal-content{background:#fff;margin:auto;border-radius:12px;width:90%;max-width:450px;overflow:hidden;}
.modal-header{background: linear-gradient(90deg,#1e90ff 0%,#0066ff 100%);padding:15px;color:white;font-family:'Poppins',sans-serif;font-size:20px;font-weight:600;display:flex;justify-content:space-between;align-items:center;}
.modal-body{padding:20px;}
.modal label{display:block;margin:10px 0 5px;color:#012970;font-weight:600;}
.modal input,.modal select{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;font-size:14px;margin-bottom:12px;}
.modal-buttons{text-align:right;margin-top:10px;}
.modal button{padding:10px 16px;border:none;border-radius:8px;cursor:pointer;font-family:'Poppins',sans-serif;font-weight:500;font-size:14px;margin-left:10px;}
.modal .save-btn{background:linear-gradient(90deg,#1e90ff 0%,#0066ff 100%);color:white;}
.modal .cancel-btn{background:#ccc;color:#000;}
</style>
</head>
<body>

<header>
  <span id="menu-toggle">&#9776;</span>
  <div class="header-content">
    <span>iAttend Admin</span>
    <div class="user-info">
      <span>Admin</span>
      <img src="https://placehold.co/36x36/899BBD/ffffff?text=A" alt="Admin Profile">
    </div>
  </div>
</header>

<div class="sidebar">
  <div class="sidebar-section">
    <a class="sidebar-link" href="#"><i class="fas fa-home"></i><span>Dashboard</span></a>
  </div>
  <div class="sidebar-section">
    <a class="sidebar-link active" href="{{ url_for('admin_schedules') }}"><i class="fas fa-calendar-alt"></i><span>Schedules</span></a>
    <a class="sidebar-link" href="{{ url_for('admin_programs') }}"><i class="fas fa-book"></i><span>Programs</span></a>
    <a class="sidebar-link" href="{{ url_for('admin_groups') }}"><i class="fas fa-users"></i><span>Groups</span></a>
    <a class="sidebar-link" href="{{ url_for('admin_modules') }}"><i class="fas fa-book-open"></i><span>Modules</span></a>
  </div>
</div>

<div class="main-content">
  <h2>Schedules</h2>
  <div style="display:flex; justify-content:flex-end; gap:10px; margin-bottom:15px;">
    <button class="action-btn edit-btn" onclick="openScheduleModal()"><i class="fas fa-plus"></i> Add Schedule</button>
  </div>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Program</th>
        <th>Group</th>
        <th>Module</th>
        <th>Day</th>
        <th>Start Time</th>
        <th>End Time</th>
        <th>Room</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for s in schedules %}
        {% set matched_program = programs | selectattr("docId", "equalto", s.fk_program) | list %}
        {% set matched_group   = groups   | selectattr("docId", "equalto", s.fk_group)   | list %}
        {% set matched_module  = modules  | selectattr("docId", "equalto", s.fk_module)  | list %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ matched_program[0].programName if matched_program else '' }}</td>
        <td>{{ matched_group[0].groupCode if matched_group else '' }}</td>
        <td>{{ matched_module[0].moduleName if matched_module else '' }}</td>
        <td>{{ s.day }}</td>
        <td>{{ s.start_time }}</td>
        <td>{{ s.end_time }}</td>
        <td>{{ s.room }}</td>
        <td>
          <form method="POST" action="{{ url_for('admin_schedule_delete', schedule_id=s.docId) }}" style="display:inline-block;">
            <button type="submit" class="action-btn delete-btn">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

</div>

<!-- Add/Edit Schedule Modal -->
<div id="scheduleModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <span id="modalTitle">Add/Edit Schedule</span>
      <span class="close" onclick="closeScheduleModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="scheduleForm" method="POST" action="{{ url_for('admin_schedule_save') }}">
        <input type="hidden" name="scheduleId" id="formScheduleId">
        <label>Program</label>
        <select name="fk_program" id="formProgram" required>
          <option value="">Select Program</option>
          {% for p in programs %}
          <option value="{{ p.docId }}">{{ p.programName }}</option>
          {% endfor %}
        </select>
        <label>Group</label>
        <select name="fk_group" id="formGroup" required>
          <option value="">Select Group</option>
          {% for g in groups %}
          <option value="{{ g.docId }}">{{ g.groupCode }}</option>
          {% endfor %}
        </select>
        <label>Module</label>
        <select name="fk_module" id="formModule" required>
          <option value="">Select Module</option>
          {% for m in modules %}
          <option value="{{ m.docId }}">{{ m.moduleName }}</option>
          {% endfor %}
        </select>
        <label>Day</label>
        <input type="text" name="day" id="formDay" required>
        <label>Start Time</label>
        <input type="time" name="start_time" id="formStartTime" required>
        <label>End Time</label>
        <input type="time" name="end_time" id="formEndTime" required>
        <label>Room</label>
        <input type="text" name="room" id="formRoom" required>
        <div class="modal-buttons">
          <button type="submit" class="save-btn">Save</button>
          <button type="button" class="cancel-btn" onclick="closeScheduleModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      Delete Schedule
      <span class="close" onclick="closeDeleteModal()">&times;</span>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete this schedule?</p>
      <form id="deleteForm" method="POST" action="">
        <div class="modal-buttons">
          <button type="submit" class="delete-btn">Delete</button>
          <button type="button" class="cancel-btn" onclick="closeDeleteModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function openScheduleModal(id='', program='', group='', module='', day='', start='', end='', room=''){
  document.getElementById('scheduleModal').classList.add('show');
  document.getElementById('modalTitle').innerText = id ? 'Edit Schedule' : 'Add Schedule';
  document.getElementById('formScheduleId').value = id;
  document.getElementById('formProgram').value = program;
  document.getElementById('formGroup').value = group;
  document.getElementById('formModule').value = module;
  document.getElementById('formDay').value = day;
  document.getElementById('formStartTime').value = start;
  document.getElementById('formEndTime').value = end;
  document.getElementById('formRoom').value = room;
}
function closeScheduleModal(){
  document.getElementById('scheduleModal').classList.remove('show');
}

function openDeleteModal(id){
  document.getElementById('deleteModal').classList.add('show');
  document.getElementById('deleteForm').action = '/admin/schedule/delete/' + id;
}
function closeDeleteModal(){
  document.getElementById('deleteModal').classList.remove('show');
}
</script>

</body>
</html>
