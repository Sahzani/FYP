<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Student List</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Nunito:wght@600;700&display=swap" rel="stylesheet" />
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  html, body {
    height:100%;
    font-family:'Roboto',sans-serif;
    background: linear-gradient(75.18deg,#FFE5B4 36.63%,#F5EEDC 92.2%);
  }
  header {
    position:fixed;
    top:0; left:0; right:0;
    height:60px;
    background:#fff;
    box-shadow:0 2px 20px rgba(1,41,112,0.1);
    display:flex;
    align-items:center;
    padding-left:20px;
    font-family:'Nunito',sans-serif;
    font-weight:700;
    font-size:26px;
    color:#212529;
    z-index:1000;
  }
  #menu-toggle { display:none; font-size:28px; margin-right:15px; cursor:pointer; }
  .sidebar {
    position: fixed;
    top:60px; left:0;
    width:260px;
    height:calc(100% - 60px);
    background:#FFEED3;
    padding:20px;
    box-shadow:0px 0px 20px rgba(1,41,112,0.1);
    font-family:'Open Sans',sans-serif;
    transition:left 0.3s ease;
    z-index:999;
  }
  .sidebar-section { margin-bottom:30px; }
  .sidebar-section-title { font-size:11px; text-transform:uppercase; color:#899BBD; margin-bottom:10px; }
  .sidebar-link {
    display:flex; align-items:center; gap:10px;
    padding:10px; margin-bottom:10px;
    background:#FFEED3; border-radius:4px;
    font-size:15px; font-weight:600; color:#012970; text-decoration:none;
    transition:background 0.3s; cursor:pointer;
  }
  .sidebar-link.active { background: rgba(221,168,83,0.44); color:#4154F1; }
  .sidebar-link:hover { background:#ffe1ab; }
  .main { margin-left:260px; padding:100px 30px 30px; font-family:'Nunito',sans-serif; }
  .page-title { font-family:'Poppins',sans-serif; font-size:28px; font-weight:500; color:#444444; margin-left:50px; margin-top:10px; margin-bottom:-1px; }
  .breadcrumb { font-family:'Nunito',sans-serif; font-size:14px; font-weight:600; margin-left:50px; margin-bottom:30px; }
  .breadcrumb .section { color:#989797; }
  .breadcrumb .current { color:#444444; }
  .breadcrumb a.section { text-decoration:none; color:#989797; }
  .card {
    background:#fff; border-radius:10px; box-shadow:0px 0px 30px rgba(1,41,112,0.1);
    padding:20px; max-width:1111px; min-width:460px; margin-left:50px; position:relative;
  }
  table { width:100%; border-collapse:collapse; font-family:'Poppins',sans-serif; font-size:14px; }
  th { background-color:#f8f7ff; text-align:left; padding:12px; font-weight:500; }
  td { padding:12px; border-top:1px solid #ddd; }
  .action-btn { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; margin-right:5px; color:white; }
  .edit-btn { background: #1e90ff; }
  .delete-btn { background: #ff4c4c; }
  .modal { display:none; position:fixed; z-index:10000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.5); justify-content:center; align-items:center; transition:opacity 0.3s; }
  .modal.show { display:flex; opacity:1; }
  .modal-content { background:#fff; margin:auto; padding:0; border-radius:12px; width:90%; max-width:450px; position:relative; overflow:hidden; transform:translateY(-50px); transition:transform 0.3s; }
  .modal.show .modal-content { transform:translateY(0); }
  .modal-header { background: linear-gradient(90deg,#1e90ff 0%,#0066ff 100%); padding:15px; color:white; font-family:'Poppins',sans-serif; font-size:20px; font-weight:600; display:flex; justify-content:space-between; align-items:center; }
  .modal-body { padding:20px; }
  .modal label { display:block; margin:10px 0 5px; color:#012970; font-weight:600; }
  .modal input, .modal select { width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; font-size:14px; margin-bottom:12px; background:linear-gradient(180deg,#fff 0%,#f9f9f9 100%); }
  .modal-buttons { text-align:right; margin-top:10px; }
  .modal button { padding:10px 16px; border:none; border-radius:8px; cursor:pointer; font-family:'Poppins',sans-serif; font-weight:500; font-size:14px; margin-left:10px; transition:all 0.2s; }
  .modal .save-btn { background:linear-gradient(90deg,#1e90ff 0%,#0066ff 100%); color:white; box-shadow:0 4px 12px rgba(0,102,255,0.3); }
  .modal .save-btn:hover { transform:translateY(-2px); }
  .modal .cancel-btn { background:#ccc; color:#000; }
  .close { font-size:26px; font-weight:bold; cursor:pointer; }
  .toast { position:fixed; bottom:20px; right:20px; background:#1e90ff; color:white; padding:12px 20px; border-radius:8px; font-family:'Poppins',sans-serif; font-size:14px; box-shadow:0 4px 12px rgba(0,102,255,0.3); opacity:0; transform:translateY(20px); transition:all 0.5s; z-index:9999; }
  .toast.show { opacity:1; transform:translateY(0); }
  @media(max-width:768px){
    #menu-toggle{display:block;}
    .sidebar{left:-260px;width:260px;}
    .sidebar.show{left:0;}
    .main{margin-left:0;padding:80px 20px 20px;}
  }
</style>
</head>
<body>

<header>
  <span id="menu-toggle">&#9776;</span>
  iAttend
</header>

<div class="sidebar">
  <div class="sidebar-section">
    <a class="sidebar-link" href="#">Dashboard</a>
    <div class="sidebar-section-title">Manage</div>
    <a class="sidebar-link active" href="#">Student List</a>
  </div>
  <div class="sidebar-section">
    <a class="sidebar-link" href="#">Add Student</a>
    <a class="sidebar-link" href="#">Logout</a>
  </div>
</div>

<div class="main">
  <h1 class="page-title">Student List</h1>
  <h2 class="breadcrumb">
    <span class="section">Manage</span> / 
    <span class="current">Student List</span>
  </h2>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Email</th>
          <th>Course</th>
          <th>Intake</th>
          <th>Class</th>
          <th>Student ID</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="studentsBody"></tbody>
    </table>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <span>Edit Student</span>
      <span class="close" id="closeEditModal">&times;</span>
    </div>
    <div class="modal-body">
      <label>First Name</label>
      <input type="text" id="editFirstName">
      <label>Last Name</label>
      <input type="text" id="editLastName">
      <label>Email</label>
      <input type="email" id="editEmail">
      <label>Course</label>
      <input type="text" id="editCourse">
      <label>Intake</label>
      <input type="text" id="editIntake">
      <label>Class</label>
      <input type="text" id="editClass">
      <label>Student ID</label>
      <input type="text" id="editID">
      <div class="modal-buttons">
        <button class="save-btn" id="saveEditBtn">Save</button>
        <button class="cancel-btn" id="cancelEditBtn">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <span>Confirm Delete</span>
      <span class="close" id="closeDeleteModal">&times;</span>
    </div>
    <div class="modal-body" id="deleteModalBody"></div>
    <div class="modal-buttons">
      <button class="save-btn" id="confirmDeleteBtn">Delete</button>
      <button class="cancel-btn" id="cancelDeleteBtn">Cancel</button>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC_pq3Gnzwkdvc9CPeRa3Yre_vkcijzVpk",
  authDomain: "aimanzamani.firebaseapp.com",
  projectId: "aimanzamani",
  storageBucket: "aimanzamani.appspot.com",
  messagingSenderId: "63348630728",
  appId: "1:63348630728:web:5d1537bd1c6e14535171fd"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const studentsBody = document.getElementById('studentsBody');
const editModal = document.getElementById('editModal');
const deleteModal = document.getElementById('deleteModal');
const toast = document.getElementById('toast');

let currentEditId = null;
let currentDeleteId = null;

function showToast(message){
  toast.textContent = message;
  toast.classList.add('show');
  setTimeout(()=>{toast.classList.remove('show');},2000);
}

// Render students
function renderStudents(snapshot){
  studentsBody.innerHTML = '';
  let index = 1;
  snapshot.forEach(docSnap=>{
    const s = docSnap.data();
    const tr = document.createElement('tr');
    tr.innerHTML=`
      <td>${index}</td>
      <td>${s.firstName||'-'}</td>
      <td>${s.lastName||'-'}</td>
      <td>${s.email||'-'}</td>
      <td>${s.course||'-'}</td>
      <td>${s.intake||'-'}</td>
      <td>${s.studentClass||'-'}</td>
      <td>${s.studentID||'-'}</td>
      <td>
        <button class="action-btn edit-btn" onclick="openEditModal('${docSnap.id}','${s.firstName}','${s.lastName}','${s.email}','${s.course}','${s.intake}','${s.studentClass}','${s.studentID}')">Edit</button>
        <button class="action-btn delete-btn" onclick="openDeleteModal('${docSnap.id}','${s.firstName} ${s.lastName}')">Delete</button>
      </td>
    `;
    studentsBody.appendChild(tr);
    index++;
  });
}

// Real-time listener
onSnapshot(collection(db,"students"), snapshot=>{
  renderStudents(snapshot);
});

// Sidebar toggle
document.getElementById('menu-toggle').addEventListener('click',()=>{document.querySelector('.sidebar').classList.toggle('show');});

// --- Edit Modal ---
const editFirstName = document.getElementById('editFirstName');
const editLastName = document.getElementById('editLastName');
const editEmail = document.getElementById('editEmail');
const editCourse = document.getElementById('editCourse');
const editIntake = document.getElementById('editIntake');
const editClass = document.getElementById('editClass');
const editID = document.getElementById('editID');

document.getElementById('closeEditModal').onclick = document.getElementById('cancelEditBtn').onclick = ()=>editModal.classList.remove('show');

window.openEditModal = (id, firstName, lastName, email, course, intake, sClass, sID)=>{
  currentEditId=id;
  editFirstName.value=firstName;
  editLastName.value=lastName;
  editEmail.value=email;
  editCourse.value=course;
  editIntake.value=intake;
  editClass.value=sClass||'';
  editID.value=sID||'';
  editModal.classList.add('show');
};

document.getElementById('saveEditBtn').onclick=async ()=>{
  if(!currentEditId) return;
  await updateDoc(doc(db,"students",currentEditId),{
    firstName: editFirstName.value,
    lastName: editLastName.value,
    email: editEmail.value,
    course: editCourse.value,
    intake: editIntake.value,
    studentClass: editClass.value,
    studentID: editID.value
  });
  editModal.classList.remove('show');
  showToast('Student updated successfully!');
};

// --- Delete Modal ---
const deleteModalBody = document.getElementById('deleteModalBody');
document.getElementById('closeDeleteModal').onclick = document.getElementById('cancelDeleteBtn').onclick = ()=>deleteModal.classList.remove('show');

window.openDeleteModal=(id,name)=>{
  currentDeleteId=id;
  deleteModalBody.textContent=`Are you sure you want to delete ${name}?`;
  deleteModal.classList.add('show');
};

document.getElementById('confirmDeleteBtn').onclick=async ()=>{
  if(!currentDeleteId) return;
  await deleteDoc(doc(db,"students",currentDeleteId));
  deleteModal.classList.remove('show');
  showToast('Student deleted successfully!');
};
</script>

</body>
</html>
