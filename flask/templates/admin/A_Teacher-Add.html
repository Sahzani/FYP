<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>iAttend - Teachers</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Poppins:wght@400;500;600&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    html,body{height:100%;font-family:'Poppins',sans-serif;background:linear-gradient(75.18deg,#FFE5B4 36.63%,#F5EEDC 92.2%);}
    header{position:fixed;top:0;left:0;right:0;height:60px;background:#fff;box-shadow:0 2px 20px rgba(1,41,112,0.1);display:flex;align-items:center;padding:0 20px;font-family:'Nunito',sans-serif;font-weight:700;font-size:26px;color:#212529;z-index:1002;}
    #menu-toggle{font-size:28px;margin-right:15px;cursor:pointer;}
    .header-content{width:100%;display:flex;justify-content:space-between;align-items:center;}
    .user-info{display:flex;align-items:center;gap:15px;padding:0 20px;border-radius:8px;cursor:pointer;transition:0.2s;}
    .user-info:hover{background:#f0f0f0;}
    .user-info img{width:36px;height:36px;border-radius:50%;object-fit:cover;}
    .user-info span{font-size:16px;font-weight:600;color:#444;}

    /* ==== Sidebar ==== */
    .sidebar{position:fixed;top:0;left:0;width:240px;height:100%;background:linear-gradient(180deg,#FFEED3 0%,#FFEED3 100%);padding-top:60px;box-shadow:2px 0 15px rgba(1,41,112,0.08);font-family:'Poppins',sans-serif;transition:width 0.3s,left 0.3s;z-index:1001;overflow-y:auto;border-top-right-radius:12px;}
    .sidebar.collapsed{width:70px;overflow:hidden;}
    .sidebar-section{margin-bottom:25px;padding:0 15px;}
    .sidebar-section-title{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:#5D5FEF;margin-bottom:10px;padding-left:10px;transition:opacity 0.3s;}
    .sidebar.collapsed .sidebar-section-title{opacity:0;}
    .sidebar-link{display:flex;align-items:center;gap:10px;padding:12px 15px;margin-bottom:8px;border-radius:8px;font-size:15px;font-weight:500;color:#1A237E;text-decoration:none;transition:all 0.25s ease;white-space:nowrap;}
    .sidebar-link i{width:18px;text-align:center;}
    .sidebar-link:hover{background:rgba(255,255,255,0.5);transform:translateX(4px);}
    .sidebar-link.active{background:rgba(255,255,255,0.7);color:#4154F1;font-weight:600;box-shadow:inset 0 0 0 1px rgba(181,116,28,0.2);}

    /* Dropdown */
    .sidebar-dropdown{display:flex;flex-direction:column;}
    .dropdown-menu{display:none;flex-direction:column;padding-left:20px;}
    .sidebar-dropdown.active .dropdown-menu{display:flex;}
    .sidebar-dropdown .dropdown-toggle i:last-child{margin-left:auto;transition: transform 0.3s;}
    .sidebar-dropdown.active .dropdown-toggle i:last-child{transform: rotate(180deg);}

    /* ==== Main Content ==== */
    .main-content{margin-left:260px;padding:100px 30px 30px;height:100vh;overflow-y:auto;transition:margin-left 0.3s ease;}
    .sidebar.collapsed ~ .main-content{margin-left:80px;}
    .card{background:#fff;padding:1.5rem;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.08);margin-bottom:20px;}
    table{width:100%;border-collapse:collapse;font-size:14px;}
    th{background-color:#f8f7ff;text-align:left;padding:12px;font-weight:500;}
    td{padding:12px;border-top:1px solid #ddd;}
    button.action-btn{padding:5px 10px;border:none;border-radius:5px;cursor:pointer;margin-right:5px;color:white;}
    .edit-btn{background:#1e90ff;}
    .delete-btn{background:#ff4c4c;}
    .upload-btn{background:#28a745;}
    .modal{display:none;position:fixed;z-index:10000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.5);justify-content:center;align-items:center;}
    .modal.show{display:flex;}
    .modal-content{background:#fff;margin:auto;border-radius:12px;width:90%;max-width:500px;overflow:hidden;}
    .modal-header{background:linear-gradient(90deg,#1e90ff 0%,#0066ff 100%);padding:15px;color:white;font-size:20px;font-weight:600;display:flex;justify-content:space-between;align-items:center;}
    .modal-body{padding:20px;}
    .modal label{display:block;margin:10px 0 5px;color:#012970;font-weight:600;}
    .modal input,.modal select{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;font-size:14px;margin-bottom:12px;}
    .modal select[multiple]{height:120px;}
    .modal-buttons{text-align:right;margin-top:10px;}
    .modal button{padding:10px 16px;border:none;border-radius:8px;cursor:pointer;font-weight:500;font-size:14px;margin-left:10px;}
    .modal .save-btn{background:linear-gradient(90deg,#1e90ff 0%,#0066ff 100%);color:white;}
    .modal .cancel-btn{background:#ccc;color:#000;}

      .main-content h2 {
    font-family: 'Poppins', sans-serif;
    font-size: 28px;
    font-weight: 500;
    color: #444;
    margin-bottom: 10px;
  }

  /* ==== Breadcrumb ==== */
.breadcrumb {
    font-family:'Nunito',sans-serif;
    font-size:14px;
    font-weight:600;  /* change from 500 to 600 */
    margin-bottom:20px; /* or 30px if you want same spacing */
}
.breadcrumb .section {
    color:#989797;
}
.breadcrumb .current {
    color:#444444;
}


    /* Coordinator switch styling */
    .switch{position:relative;display:inline-block;width:40px;height:20px;}
    .switch input{opacity:0;width:0;height:0;}
    .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:20px;}
    .slider:before{position:absolute;content:"";height:16px;width:16px;left:2px;bottom:2px;background-color:white;transition:.4s;border-radius:50%;}
    input:checked + .slider{background-color:#1e90ff;}
    input:checked + .slider:before{transform:translateX(20px);}
  </style>
</head>

<body>

  <header>
    <span id="menu-toggle">&#9776;</span>
    <div class="header-content">
      <span>iAttend Admin</span>
      <div class="user-info"><span>Admin</span><img src="https://placehold.co/36x36/899BBD/ffffff?text=A"></div>
    </div>
  </header>

<!-- ========== SIDEBAR ========== -->
<div class="sidebar">
  <div class="sidebar-section">
    <a class="sidebar-link {% if request.endpoint == 'admin_dashboard' %}active{% endif %}" href="{{ url_for('admin_dashboard') }}">
      <i class="fas fa-home"></i><span>Dashboard</span>
    </a>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-title">Management</div>

    <a class="sidebar-link {% if request.endpoint == 'admin_student_add' %}active{% endif %}" href="{{ url_for('admin_student_add') }}">
      <i class="fas fa-user-graduate"></i><span>Add Students</span>
    </a>

    <div class="sidebar-dropdown {% if request.endpoint in ['admin_teacher_add','admin_teacher_assign'] %}active{% endif %}">
      <a class="sidebar-link dropdown-toggle">
        <i class="fas fa-chalkboard-teacher"></i><span>Teachers</span><i class="fas fa-chevron-down"></i>
      </a>
      <div class="dropdown-menu">
        <a class="sidebar-link {% if request.endpoint == 'admin_teacher_add' %}active{% endif %} active" href="{{ url_for('admin_teacher_add') }}"><span>Add Teacher</span></a>
        <a class="sidebar-link {% if request.endpoint == 'admin_teacher_assign' %}active{% endif %}" href="{{ url_for('admin_teacher_assign') }}"><span>Assign Modules / Rooms</span></a>
      </div>
    </div>

    <a class="sidebar-link {% if request.endpoint == 'admin_modules' %}active{% endif %}" href="{{ url_for('admin_modules') }}">
      <i class="fas fa-book"></i><span>Modules</span>
    </a>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-title">System</div>
    <a class="sidebar-link {% if request.endpoint == 'admin_rooms' %}active{% endif %}" href="{{ url_for('admin_rooms') }}"><i class="fas fa-door-open"></i><span>Rooms & Cameras</span></a>
    <a class="sidebar-link {% if request.endpoint == 'admin_schedules' %}active{% endif %}" href="{{ url_for('admin_schedules') }}"><i class="fas fa-file-upload"></i><span>Upload Schedules</span></a>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-title">Logs</div>
    <a class="sidebar-link {% if request.endpoint == 'admin_attendance_logs' %}active{% endif %}" href="{{ url_for('admin_attendance_logs') }}"><i class="fas fa-history"></i><span>Attendance Logs</span></a>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-title">Attendance</div>
    <a class="sidebar-link {% if request.endpoint == 'admin_summary' %}active{% endif %}" href="{{ url_for('admin_dashboard') }}"><i class="fas fa-chart-line"></i><span>Summary</span></a>
    <a class="sidebar-link" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
  </div>
</div>



<div class="main-content">
  <h2>Add Teacher</h2>
  <div class="breadcrumb">
  <span class="section">Management</span> / <span class="section">Teachers</span> / <span class="current">Add Teacher</span>
</div>
    <div style="display:flex; justify-content:flex-end; gap:10px; margin-bottom:15px;">
      <button class="action-btn edit-btn" onclick="openAddModal()"><i class="fas fa-plus"></i> Add Teacher</button>
      <button class="action-btn upload-btn" onclick="openUploadModal()"><i class="fas fa-file-csv"></i> Upload
        CSV</button>
    </div>

    <div class="card">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Email</th>
            <th>Program</th>
            <th>Teacher ID</th>
            <th>Coordinator</th>
            <th>Group</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for teacher in teachers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ teacher.firstName }}</td>
            <td>{{ teacher.lastName }}</td>
            <td>{{ teacher.email }}</td>
            <td>{{ teacher.programName }}</td>
            <td>{{ teacher.teacherID }}</td>
            <td>{{ 'Yes' if teacher.isCoordinator else 'No' }}</td>
            <td>
              {% if teacher.isCoordinator %}
                {{ teacher.groupCode }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              <button class="action-btn edit-btn" onclick="openEditModal('{{ teacher.uid }}')">Edit</button>
              <button class="action-btn delete-btn" onclick="openDeleteModal('{{ teacher.uid }}')">Delete</button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Add/Edit Teacher Modal -->
  <div id="teacherModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="modalTitle">Add/Edit Teacher</span>
        <span class="close" onclick="closeTeacherModal()">&times;</span>
      </div>
      <div class="modal-body">
        <form id="teacherForm" method="POST" action="{{ url_for('admin_teacher_save') }}">
          <input type="hidden" id="formTeacherId" name="userId">
          <label for="formFirstName">First Name:</label>
          <input type="text" id="formFirstName" name="firstName" required>
          <label for="formLastName">Last Name:</label>
          <input type="text" id="formLastName" name="lastName" required>
          <label for="formEmail">Email:</label>
          <input type="email" id="formEmail" name="email" required>
          <label for="formPassword">Password:</label>
          <input type="password" id="formPassword" name="password">
          <label for="formTeacherID">Teacher ID:</label>
          <input type="text" id="formTeacherID" name="teacherID" required>
          <label for="formProgram">Program:</label>
          <select id="formProgram" name="program" required>
            <option value="">-- Select Program --</option>
            {% for p in programs %}
            <option value="{{ p['docId'] }}">{{ p['programName'] }}</option>
            {% endfor %}
          </select>

          <!-- Assign Group Dropdown (hidden by default) -->
          <label for="formGroup" id="formGroupLabel" style="display:none;">Assign Group:</label>
          <select id="formGroup" name="groupCode" style="display:none;">
            <option value="">-- Select Group --</option>
            {% for group in groups %}
            <option value="{{ group.id }}">{{ group.groupCode }} ({{ group.intake }})</option>
            {% endfor %}
          </select>

          <!-- Coordinator Toggle -->
          <div
            style="display:flex; align-items:center; justify-content: space-between; margin-top:8px; margin-bottom:12px;">
            <label class="switch-text" for="formIsCoordinator">Is Coordinator</label>
            <label class="switch">
              <input type="checkbox" id="formIsCoordinator" name="isCoordinator" onchange="toggleGroupDropdown()">
              <span class="slider"></span>
            </label>
          </div>



          <div class="modal-buttons">
            <button type="button" class="cancel-btn" onclick="closeTeacherModal()">Cancel</button>
            <button type="submit" class="save-btn">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Upload CSV Modal -->
  <div id="uploadModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span>Upload Teachers CSV</span>
        <span class="close" onclick="closeUploadModal()">&times;</span>
      </div>
      <div class="modal-body">
        <form method="POST" action="{{ url_for('admin_teacher_upload') }}" enctype="multipart/form-data">
          <label for="csvFile">Select CSV File:</label>
          <input type="file" id="csvFile" name="csv_file" accept=".csv" required>
          <button type="submit" class="upload-btn">Upload</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Dropdown toggle
document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
  toggle.addEventListener('click', e => {
    e.preventDefault();
    toggle.parentElement.classList.toggle('active');
  });
});

    
    const menuToggle = document.getElementById('menu-toggle');
    const sidebar = document.querySelector('.sidebar');
    menuToggle.addEventListener('click', () => { sidebar.classList.toggle('collapsed'); });

    function toggleGroupDropdown() {
      const isCoordinator = document.getElementById('formIsCoordinator').checked;
      const groupLabel = document.getElementById('formGroupLabel');
      const groupSelect = document.getElementById('formGroup');

      if (isCoordinator) {
        groupLabel.style.display = "block";
        groupSelect.style.display = "block";
      } else {
        groupLabel.style.display = "none";
        groupSelect.style.display = "none";
        groupSelect.value = ""; // clear selection if unchecked
      }
    }

    function openAddModal() {
      document.getElementById('modalTitle').innerText = "Add Teacher";
      document.getElementById('formTeacherId').value = "";
      document.getElementById('formFirstName').value = "";
      document.getElementById('formLastName').value = "";
      document.getElementById('formEmail').value = "";
      document.getElementById('formPassword').value = "";
      document.getElementById('formTeacherID').value = "";
      document.getElementById('formProgram').selectedIndex = 0;
      document.getElementById('formIsCoordinator').checked = false; toggleGroupDropdown();
      document.getElementById('teacherModal').classList.add('show');
    }

    function openEditModal(uid) {
      fetch(`/api/teacher/${uid}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('modalTitle').innerText = "Edit Teacher";
          document.getElementById('formTeacherId').value = uid;
          document.getElementById('formFirstName').value = data.firstName;
          document.getElementById('formLastName').value = data.lastName;
          document.getElementById('formEmail').value = data.email;
          document.getElementById('formPassword').value = "";
          document.getElementById('formTeacherID').value = data.teacherID;
          document.getElementById('formProgram').value = data.program;
          document.getElementById('formIsCoordinator').checked = data.isCoordinator;
          document.getElementById('teacherModal').classList.add('show');

          // Group dropdown for coordinators
          toggleGroupDropdown();
          if (data.isCoordinator && data.groupCode) {
            document.getElementById('formGroup').value = data.groupCode;
          }

          document.getElementById('teacherModal').classList.add('show');
        });
    }

    function closeTeacherModal() { document.getElementById('teacherModal').classList.remove('show'); }
    function openUploadModal() { document.getElementById('uploadModal').classList.add('show'); }
    function closeUploadModal() { document.getElementById('uploadModal').classList.remove('show'); }

    function openDeleteModal(uid) {
      if (confirm("Are you sure you want to delete this teacher?")) {
        fetch(`/admin/teacher/delete/${uid}`, { method: 'POST' })
          .then(res => res.json())
          .then(data => {
            if (data.success) {
              alert('Teacher deleted successfully!');

              // Remove the row from the table
              const row = document.querySelector(`button[onclick="openDeleteModal('${uid}')"]`).closest('tr');
              if (row) row.remove();
            } else {
              alert('Error: ' + (data.error || 'Unknown'));
            }
          })
          .catch(err => {
            alert('Error: ' + err);
          });
      }
    }

  </script>

</body>

</html>
