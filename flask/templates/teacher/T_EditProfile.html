<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>iAttend Teacher Profile</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Nunito:wght@600;700&display=swap" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
<style>
/* -------------------- Main Content -------------------- */
.main-content {
    margin-left:260px; padding:100px 30px 30px; font-family:'Nunito',sans-serif;
    transition:margin-left 0.3s ease; height:100vh; overflow-y:auto;
}
.sidebar.collapsed ~ .main-content { margin-left:80px; }

/* -------------------- Profile Sections -------------------- */
.profile-sections { display:flex; flex-direction:column; gap:30px; max-width:900px; margin:0 auto; }

/* -------------------- Card -------------------- */
.card {
    background:#fff; padding:30px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card:hover { transform: translateY(-5px); box-shadow:0 15px 30px rgba(0,0,0,0.15); }
.card h2 {
    margin-top:0; margin-bottom:20px; font-family:'Nunito',sans-serif; font-weight:600; font-size:24px; 
    color:#012970; border-bottom:1px solid #eee; padding-bottom:10px;
}

/* -------------------- Profile Content -------------------- */
.profile-content { display:flex; gap:40px; align-items:flex-start; }
.profile-pic-container { position:relative; width:120px; height:120px; flex-shrink:0; transition: transform 0.3s ease; }
.profile-pic-container:hover { transform: scale(1.05); }
.profile-pic-container img { width:100%; height:100%; border-radius:50%; object-fit:cover; border:2px solid #ddd; transition: border 0.3s ease; }
.profile-pic-container:hover img { border:2px solid #4154F1; }
.edit-icon { position:absolute; bottom:0; right:0; background:#4154F1; color:#fff; padding:8px; border-radius:50%; cursor:pointer; font-size:14px; box-shadow:0 2px 5px rgba(0,0,0,0.2); transition:background 0.3s ease; }
.edit-icon:hover { background:#0d29e9; }

.profile-details { flex-grow:1; display:grid; grid-template-columns:repeat(auto-fit, minmax(250px,1fr)); gap:20px; }
.form-group { display:flex; flex-direction:column; }
.form-group label { font-size:14px; color:#555; margin-bottom:5px; font-weight:600; }
.form-group input {
    padding:10px 12px; border:1px solid #ddd; border-radius:5px; background:#fcfcfc; font-size:15px; font-family:'Open Sans',sans-serif; transition:0.3s;
}
.form-group input:focus { border-color:#4154F1; box-shadow:0 0 5px rgba(65,84,241,0.4); outline:none; }
.form-group input:disabled { background:#f5f5f5; color:#777; cursor:not-allowed; }

/* -------------------- Buttons & Actions -------------------- */
.card-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:30px; }
.btn { padding:10px 20px; border-radius:5px; cursor:pointer; border:none; font-weight:600; font-family:'Nunito',sans-serif; transition: all 0.3s ease; }
.btn-primary { background:#4154F1; color:white; }
.btn-primary:hover { background:#0d29e9; transform: translateY(-2px); }
.btn-secondary { background:#6c757d; color:white; }
.btn-secondary:hover { background:#5a6268; transform: translateY(-2px); }

/* -------------------- Status Message -------------------- */
.status-message { margin-top:15px; font-size:14px; font-family:'Open Sans',sans-serif; font-style:italic; color:#333; }

/* -------------------- Modal -------------------- */
.modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:1000; opacity:0; visibility:hidden; transition:0.3s; }
.modal.open { opacity:1; visibility:visible; }
.modal-content { background:#fff; padding:30px; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,0.3); width:90%; max-width:500px; position:relative; transform:translateY(-20px); transition: transform 0.3s ease; }
.modal.open .modal-content { transform:translateY(0); }
.modal-close-btn { position:absolute; top:15px; right:15px; font-size:24px; cursor:pointer; color:#aaa; transition: color 0.3s; }
.modal-close-btn:hover { color:#333; }

/* -------------------- Responsive -------------------- */
@media(max-width:992px) {
    .profile-content { flex-direction:column; align-items:center; text-align:center; }
    .profile-details { grid-template-columns:1fr; }
}
</style>

</head>
<body>
<!-- Header -->
<header>
  <span id="menu-toggle">&#9776;</span>
  <div class="header-content">
    <a href="{{ url_for('teacher_dashboard') }}" class="title">iAttend</a>
    <a href="{{ url_for('teacher_profile') }}" class="user-info">
      <span>{{ profile.firstName }} {{ profile.lastName }}</span>
      <img src="{% if profile.photo_name.startswith('http') %}{{ profile.photo_name }}{% else %}{{ url_for('static', filename=profile.photo_name) }}{% endif %}" alt="Teacher Profile">
    </a>
  </div>
</header>

<!-- Sidebar -->
<div class="sidebar">
  <div class="sidebar-section">
    <a class="sidebar-link" href="{{ url_for('teacher_dashboard') }}">
      <i class="fas fa-home"></i><span>Dashboard</span>
    </a>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-title">Reports</div>
    <a class="sidebar-link" href="{{ url_for('teacher_attendance') }}">
      <i class="fas fa-chart-bar"></i><span>Attendance Report</span>
    </a>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-title">Manage</div>
    <a class="sidebar-link" href="{{ url_for('teacher_schedules') }}">
      <i class="fas fa-calendar"></i><span>Class Schedule</span>
    </a>
    <a class="sidebar-link" href="{{ url_for('teacher_modules') }}">
      <i class="fas fa-book"></i><span>My Modules & Rooms</span>
    </a>
    <a class="sidebar-link" href="{{ url_for('teacher_manage_absent') }}">
      <i class="fas fa-calendar-alt"></i><span>Absences Application</span>
    </a>
  </div>

  {% if profile.is_gc %}
  <div class="sidebar-section">
    <div class="sidebar-section-title">Group Coordinator</div>
    <a class="sidebar-link" href="{{ url_for('gc_manage_group') }}">
      <i class="fas fa-users-cog"></i><span>Manage Group</span>
    </a>
    <a class="sidebar-link" href="{{ url_for('gc_group_report') }}">
      <i class="fas fa-file-alt"></i><span>Group Report</span>
    </a>
  </div>
  {% endif %}

  <div class="sidebar-section">
    <a class="sidebar-link" href="{{ url_for('teacher_logout') }}">
      <i class="fas fa-sign-out-alt"></i><span>Logout</span>
    </a>
  </div>
</div>

<!-- Main content -->
<div class="main-content" style="font-family:'Nunito',sans-serif;">
  <div class="profile-sections">

    <!-- Profile Card -->
    <div class="card user-profile-card">
      <h2 style="font-family:'Poppins',sans-serif; font-weight:600; color:#4154F1;">Edit Teacher Profile</h2>
      <div class="profile-content">

        <!-- Profile Form -->
        <form id="profile-form" class="profile-details" method="POST" action="{{ url_for('teacher_edit_profile') }}" enctype="multipart/form-data">
          
          <!-- Profile Picture -->
          <div style="position:relative; width:120px; height:120px;">
            <div class="profile-pic-container" style="width:120px; height:120px; display:flex; align-items:center; justify-content:center; font-size:50px; font-weight:700; color:#fff; background:#4154F1; border-radius:50%; overflow:hidden;">
              
              {% if profile.photo_name %}
                <img id="user-profile-pic" 
                     src="{% if profile.photo_name.startswith('http') %}{{ profile.photo_name }}{% else %}{{ url_for('static', filename=profile.photo_name) }}?v={{ now }}{% endif %}" 
                     alt="Profile Picture" style="width:100%; height:100%; object-fit:cover;">
              {% else %}
                {{ profile.firstName[0] if profile.firstName else 'T' }}
              {% endif %}
              
              <input type="file" id="profile-pic-upload" name="profile_pic" accept="image/*" style="display:none;">
            </div>

            <!-- Camera icon overlapping bottom-right -->
            <i class="fas fa-camera edit-icon" 
               onclick="document.getElementById('profile-pic-upload').click();" 
               style="position:absolute; bottom:0; right:0; transform:translate(25%, 25%); font-size:16px; color:#fff; background:#4154F1; border-radius:50%; padding:6px; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.3);">
            </i>
          </div>

          <div class="form-group">
            <label for="first-name-input">First Name</label>
            <input type="text" id="first-name-input" value="{{ profile.firstName }}" disabled>
          </div>
          <div class="form-group">
            <label for="last-name-input">Last Name</label>
            <input type="text" id="last-name-input" value="{{ profile.lastName }}" disabled>
          </div>
          <div class="form-group">
            <label for="nickname-input">Nickname</label>
            <input type="text" name="nickname" id="nickname-input" value="{{ profile.nickname }}">
          </div>
          <div class="form-group">
            <label for="phone-input">Phone Number</label>
            <input type="text" name="phone" id="phone-input" value="{{ profile.phone }}">
          </div>
          <div class="form-group">
            <label for="email-input">Email</label>
            <input type="email" id="email-input" value="{{ profile.email }}" disabled>
          </div>

          <!-- Card Actions -->
          <div class="card-actions">
            <button type="submit" name="action" value="cancel" class="btn btn-secondary">Cancel</button>
            <button type="submit" name="action" value="save" class="btn btn-primary">Save Changes</button>
          </div>

        </form>
      </div>
    </div>

    <!-- Password Change Card -->
    <div class="card password-change-card">
      <h2 style="font-family:'Poppins',sans-serif; font-weight:600; color:#4154F1;">Password Change</h2>
      <p style="font-family:'Nunito',sans-serif; font-size:14px; color:#555; margin-bottom:15px;">
        For security reasons, you can change your password here.
      </p>
      <a href="{{ url_for('teacher_change_password') }}" class="btn btn-primary" style="text-decoration:none;">Change Password</a>
    </div>

  </div>
</div>


<script>
const menuToggle = document.getElementById('menu-toggle');
const sidebar = document.querySelector('.sidebar');
const mainContent = document.querySelector('.main-content');

// Sidebar toggle
menuToggle.addEventListener('click', () => {
  sidebar.classList.toggle('collapsed');
  mainContent.classList.toggle('expanded');
});

// Profile picture live preview before saving
const profilePicInput = document.getElementById('profile-pic-upload');
const profilePicImg = document.getElementById('user-profile-pic');

profilePicInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if(file && file.type.startsWith('image/')) {
    const reader = new FileReader();
    reader.onload = (event) => {
      profilePicImg.src = event.target.result; // live preview
    };
    reader.readAsDataURL(file);
  } else {
    profilePicInput.value = ''; // Reset if not an image
    alert("Please select a valid image file (png, jpg, jpeg, gif).");
  }
});
</script>

</body>
</html>
