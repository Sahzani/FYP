<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>iAttend - Daily Attendance</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  html, body { 
    height: 100%; 
    font-family: 'Roboto', sans-serif; 
    background: linear-gradient(75.18deg, #FFE5B4 36.63%, #F5EEDC 92.2%);
  }
  #sidebar { transition: left 0.3s ease; }
  @media (max-width: 768px) { #sidebar { left: -16rem; position: fixed; top: 0; height: 100%; z-index: 30; } #sidebar.show { left: 0; } }
  main { transition: margin-left 0.3s; margin-left: 16rem; padding: 40px 20px; }
  @media (max-width:768px){ main{margin-left:0;} }

  .attendance-table-wrapper { max-width: 900px; margin: 20px auto; }
</style>
</head>
<body>

<!-- Header -->
<header class="fixed top-0 left-0 right-0 h-16 bg-white shadow flex justify-between items-center px-4 z-40">
  <div class="flex items-center space-x-4">
    <button id="menu-toggle" class="text-2xl md:hidden"><i class="fas fa-bars"></i></button>
    <div class="text-2xl font-bold text-gray-800">iAttend Teacher</div>
  </div>
  <div class="flex items-center space-x-4">
    <a href="#" class="flex items-center space-x-2">
      <span class="font-semibold text-gray-800">Teacher Name</span>
      <div class="h-10 w-10 rounded-full overflow-hidden">
        <img src="https://placehold.co/40x40/b8c6ff/ffffff?text=T" alt="Teacher" class="w-full h-full object-cover">
      </div>
    </a>
  </div>
</header>

<!-- Sidebar -->
<div id="sidebar" class="fixed top-16 left-0 w-64 h-[calc(100%-4rem)] bg-[#FFEED3] p-4 shadow overflow-y-auto z-30">
  <div class="mb-6">
    <div class="text-xs font-semibold text-gray-400 uppercase mb-2">Menu</div>
    <a href="T_dashboard.html" class="flex items-center gap-2 p-2 rounded hover:bg-[#ffe1ab] text-[#012970] font-semibold"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    <a href="T_class_list.html" class="flex items-center gap-2 p-2 rounded hover:bg-[#ffe1ab] text-[#012970] font-semibold"><i class="fas fa-school"></i> View Class List</a>
    <a href="T_StartAttendance.html" class="flex items-center gap-2 p-2 rounded hover:bg-[#ffe1ab] text-[#012970] font-semibold"><i class="fas fa-clipboard-check"></i> Start Attendance</a>
    <a href="T_DailyAttend.html" class="flex items-center gap-2 p-2 rounded hover:bg-[#ffe1ab] text-[#012970] font-semibold bg-[#e5d7b8]"><i class="fas fa-calendar-day"></i> Daily Attendance</a>
  </div>
  <div>
    <a href="T_login.html" class="flex items-center gap-2 p-2 rounded hover:bg-[#ffe1ab] text-red-600 font-semibold"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>
</div>

<div id="overlay" class="fixed inset-0 bg-black bg-opacity-30 hidden z-20"></div>

<!-- Main Content -->
<main>
  <h2 class="text-2xl font-bold text-gray-800 mb-1">Daily Attendance</h2>
  <p class="text-sm text-gray-500 mb-6">Dashboard / Daily Attendance</p>

  <!-- Filter by Class -->
  <div class="mb-6 bg-white p-4 rounded-2xl shadow flex flex-wrap gap-4 items-center justify-center">
    <label class="font-semibold text-gray-700">Select Class:</label>
    <select id="class-select" class="p-2 rounded border border-gray-300">
      <option value="all">All Classes</option>
      <!-- dynamically fill with classes from backend -->
    </select>
    <button id="filter-btn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Filter</button>
  </div>

  <!-- Attendance Table -->
  <div class="attendance-table-wrapper bg-white p-6 rounded-2xl shadow">
    <h3 class="text-xl font-bold text-gray-800 mb-4">Todayâ€™s Attendance</h3>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200" id="daily-attendance-table">
        <thead>
          <tr class="bg-gray-50">
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Class</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Timestamp</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200"></tbody>
      </table>
    </div>
  </div>
</main>

<script>
const menuToggle = document.getElementById('menu-toggle');
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');

menuToggle.addEventListener('click', () => {
    sidebar.classList.toggle('show');
    overlay.classList.toggle('hidden');
});
overlay.addEventListener('click', () => {
    sidebar.classList.remove('show');
    overlay.classList.add('hidden');
});

// Fetch daily attendance
async function fetchDailyAttendance(classFilter='all') {
    try {
        const response = await fetch(`/daily_attendance?class=${classFilter}`);
        const data = await response.json();
        const tbody = document.querySelector('#daily-attendance-table tbody');
        tbody.innerHTML = '';

        data.attendance.forEach(entry => {
            const row = document.createElement('tr');
            row.classList.add("hover:bg-gray-100");
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${entry.name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${entry.email}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${entry.class_name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${entry.time}</td>
            `;
            tbody.appendChild(row);
        });
    } catch(err) {
        console.error('Error fetching daily attendance:', err);
    }
}

// Initial load
fetchDailyAttendance();

// Filter by class
document.getElementById('filter-btn').addEventListener('click', () => {
    const classFilter = document.getElementById('class-select').value;
    fetchDailyAttendance(classFilter);
});
</script>

</body>
</html>
