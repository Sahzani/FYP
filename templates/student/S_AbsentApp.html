<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Absence Management</title>
  <style>
    /* === Sidebar === */
    .sidebar {
      width: 250px;
      background: #2c3e50;
      color: white;
      position: fixed;
      top: 0; left: 0; bottom: 0;
      padding: 20px;
      transition: width 0.3s ease;
    }
    .sidebar.collapsed {
      width: 60px;
    }
    #menu-toggle {
      cursor: pointer;
      color: white;
      margin-bottom: 20px;
      display: inline-block;
    }

    /* === Table === */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-left: 270px;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #f4f4f4;
    }
    .status.in-progress { color: orange; }
    .status.approved { color: green; }
    .status.rejected { color: red; }

    /* === Modal === */
    .modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0; top: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
    }
    .modal.show { display: block; }
    .modal-content {
      background: white;
      margin: 10% auto;
      padding: 20px;
      width: 400px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s ease;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 18px;
      margin-bottom: 15px;
    }
    .modal-header .close {
      cursor: pointer;
      font-size: 20px;
    }
    .modal-body label {
      display: block;
      margin: 8px 0 4px;
    }
    .modal-body input, .modal-body select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    .save-btn, .cancel-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .save-btn { background: #3498db; color: white; }
    .cancel-btn { background: #ccc; }

    /* === Toast === */
    .toast {
      visibility: hidden;
      min-width: 200px;
      margin-left: -100px;
      background: #333;
      color: #fff;
      text-align: center;
      border-radius: 4px;
      padding: 12px;
      position: fixed;
      left: 50%;
      bottom: 30px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.5s, bottom 0.5s;
    }
    .toast.show {
      visibility: visible;
      opacity: 1;
      bottom: 50px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

<div class="sidebar">
  <span id="menu-toggle">â˜°</span>
  <h2>Menu</h2>
  <button id="openApplicationModal">New Application</button>
</div>

<table>
  <thead>
    <tr>
      <th>#</th>
      <th>Student Name</th>
      <th>Course</th>
      <th>Reason</th>
      <th>Duration</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody id="recordsBody"></tbody>
</table>

<!-- === Modal HTML === -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <span>New Absence Application</span>
      <span class="close">&times;</span>
    </div>
    <div class="modal-body">
      <label>Student Name</label>
      <input type="text" id="modalStudentName">
      <label>Course</label>
      <input type="text" id="modalCourse">
      <label>Reason</label>
      <input type="text" id="modalReason">
      <label>Duration</label>
      <select id="modalDuration">
        <option value="1 day">1 day</option>
        <option value="2 days">2 days</option>
        <option value="3 days">3 days</option>
        <option value="1 week">1 week</option>
      </select>
      <div class="modal-buttons">
        <button class="save-btn" id="saveBtn">Send</button>
        <button class="cancel-btn" id="cancelBtn">Cancel</button>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast">Application sent successfully!</div>

<!-- === Firebase Init === -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC_pq3Gnzwkdvc9CPeRa3Yre_vkcijzVpk",
  authDomain: "aimanzamani.firebaseapp.com",
  projectId: "aimanzamani",
  storageBucket: "aimanzamani.appspot.com",
  messagingSenderId: "63348630728",
  appId: "1:63348630728:web:5d1537bd1c6e14535171fd"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
</script>

<!-- === App Logic === -->
<script>
const menuToggle = document.getElementById('menu-toggle');
const sidebar = document.querySelector('.sidebar');
const recordsBody = document.getElementById('recordsBody');

menuToggle.addEventListener('click', ()=> sidebar.classList.toggle('collapsed'));

document.addEventListener('click',(e)=>{
  if(window.innerWidth<=768 && sidebar.classList.contains('show')){
    if(!sidebar.contains(e.target) && e.target!==menuToggle) sidebar.classList.remove('show');
  }
});

const modal = document.getElementById('editModal');
const closeBtn = modal.querySelector('.close');
const saveBtn = document.getElementById('saveBtn');
const cancelBtn = document.getElementById('cancelBtn');
const openApplicationModal = document.getElementById('openApplicationModal');
const toast = document.getElementById('toast');

function showToast(message){
  toast.textContent=message;
  toast.classList.add('show');
  setTimeout(()=>{toast.classList.remove('show');},2000);
}

function renderRecords(){
  const records = JSON.parse(localStorage.getItem('absenceRecords'))||[];
  recordsBody.innerHTML='';
  records.forEach((rec, idx)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${idx+1}</td>
      <td>${rec.studentName}</td>
      <td>${rec.course}</td>
      <td>${rec.reason}</td>
      <td>${rec.duration}</td>
      <td><span class="status ${rec.status.toLowerCase().replace(' ','-')}">${rec.status}</span></td>
    `;
    recordsBody.appendChild(tr);
  });
}
window.addEventListener('storage', renderRecords);

function openModal(){
  modal.classList.add('show');
  document.getElementById('modalStudentName').value='';
  document.getElementById('modalCourse').value='';
  document.getElementById('modalReason').value='';
  document.getElementById('modalDuration').value='1 day';
}
closeBtn.onclick = cancelBtn.onclick = () => modal.classList.remove('show');

saveBtn.onclick = () => {
  const studentName = document.getElementById('modalStudentName').value.trim();
  const course = document.getElementById('modalCourse').value.trim();
  const reason = document.getElementById('modalReason').value.trim();
  const duration = document.getElementById('modalDuration').value;
  if(!studentName || !course || !reason){ alert('Please fill in all fields!'); return; }
  const records = JSON.parse(localStorage.getItem('absenceRecords'))||[];
  records.push({studentName, course, reason, duration, status:'In Progress'});
  localStorage.setItem('absenceRecords', JSON.stringify(records));
  renderRecords();
  modal.classList.remove('show');
  showToast('Application sent successfully!');
}

openApplicationModal.onclick = openModal;
renderRecords();
</script>

</body>
</html>
