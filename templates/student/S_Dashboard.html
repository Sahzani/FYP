<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Reset */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; font-family: 'Roboto', sans-serif; background: linear-gradient(75.18deg, #FFE5B4 36.63%, #F5EEDC 92.2%); }

        .page-header {
            position: fixed; top: 0; left: 0; right: 0; height: 60px;
            background: #fff; box-shadow: 0 2px 20px rgba(1, 41, 112, 0.1);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; z-index: 10; font-family: 'Nunito', sans-serif;
        }
        .page-header .logo { font-weight: 700; font-size: 26px; color: #212529; }

        .sidebar {
            position: fixed; top: 60px; left: 0; width: 260px; height: calc(100% - 60px);
            background: #FFEED3; padding: 20px; box-shadow: 0 0 20px rgba(1, 41, 112, 0.1);
            font-family: 'Open Sans', sans-serif; overflow-y: auto;
        }
        .sidebar-section { margin-bottom: 30px; }
        .sidebar-section-title { font-size: 11px; text-transform: uppercase; color: #899BBD; margin-bottom: 10px; letter-spacing: 0.5px; font-weight: 600; }
        .sidebar-link {
            display: flex; align-items: center; gap: 10px; padding: 10px 12px; margin-bottom: 10px;
            background: #FFEED3; border-radius: 4px; font-size: 15px; font-weight: 600; color: #012970;
            text-decoration: none; transition: background 0.3s; cursor: pointer;
        }
        .sidebar-link:hover { background: #ffe1ab; }
        .sidebar-link.active { background: none; color: #4154F1; }

        .main-content { margin-left: 260px; padding: 80px 20px; }

        .progress-circle { position: relative; width: 100px; height: 100px; border-radius: 50%; display: flex; justify-content: center; align-items: center; background-color: #e2e8f0; overflow: hidden; }
        .progress-circle .inner-circle { width: 80px; height: 80px; background-color: white; border-radius: 50%; position: relative; z-index: 2; }
        .progress-circle .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; clip-path: inset(0 0 20% 0); background-color: #22c55e; transform: rotate(180deg); z-index: 1; }
    </style>
</head>
<body>

<header class="page-header">
    <div class="logo">iAttend</div>
    <div class="flex items-center space-x-4">
        <div class="relative w-full max-w-sm">
            <input type="text" placeholder="Search" class="w-full pl-10 pr-4 py-2 text-sm text-gray-700 placeholder-gray-500 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500">
            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        </div>
        <a href="{{ url_for('student_profile') }}" class="flex items-center space-x-3 cursor-pointer">
            <span class="text-sm font-semibold text-gray-800">{{ student.name }}</span>
            <div class="h-10 w-10 bg-gray-200 rounded-full overflow-hidden flex-shrink-0">
                <img src="{{ student.profile_pic }}" alt="{{ student.name }}" class="h-full w-full object-cover">
            </div>
        </a>
    </div>
</header>

<div class="sidebar">
    <div class="sidebar-section">
        <a class="sidebar-link {% if active_page == 'dashboard' %}active{% endif %}" href="{{ url_for('student_dashboard') }}">
            <i class="fas fa-th-large"></i> Dashboard
        </a>
    </div>
    <div class="sidebar-section">
        <div class="sidebar-section-title">Analyse</div>
        <a class="sidebar-link {% if active_page == 'attendance' %}active{% endif %}" href="{{ url_for('student_history') }}">
            <i class="fas fa-list-alt"></i> Attendance
        </a>
    </div>
    <div class="sidebar-section">
        <div class="sidebar-section-title">Request</div>
        <a class="sidebar-link {% if active_page == 'absent' %}active{% endif %}" href="{{ url_for('student_absentapp') }}">
            <i class="fas fa-paper-plane"></i> Absent Application
        </a>
    </div>
    <div class="sidebar-section mt-auto">
        <div class="sidebar-section-title">Logout</div>
        <a class="sidebar-link" href="{{ url_for('logout') }}">
            <i class="fas fa-sign-out-alt text-red-500"></i> Logout
        </a>
    </div>
</div>

<div class="main-content">
    <h2 class="text-2xl font-bold text-gray-800 mb-1">Welcome, {{ student.name }}!</h2>
    <p class="text-sm text-gray-500 mb-6">Dashboard / Home</p>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white p-6 rounded-2xl shadow-xl md:col-span-3">
                <div class="flex items-center space-x-4">
                    <div class="h-16 w-16 bg-gray-200 rounded-full overflow-hidden flex-shrink-0">
                        <img src="{{ student.profile_pic }}" alt="{{ student.name }}" class="h-full w-full object-cover">
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-800 text-lg">{{ student.full_name }}</h3>
                        <p class="text-gray-500 text-sm">ID: {{ student.id }}</p>
                        <p class="text-gray-500 text-sm">Email: {{ student.email }}</p>
                        <p class="text-gray-500 text-sm">Class: {{ student.class }}</p>
                        <p class="text-gray-500 text-sm">Intake: {{ student.intake }}</p>
                        <p class="text-gray-500 text-sm">Semester {{ student.semester }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-xl flex flex-col items-center text-center">
                <div class="w-12 h-12 flex items-center justify-center bg-blue-500 text-white rounded-full mb-3">
                    <i class="fas fa-hourglass-half"></i>
                </div>
                <p class="text-sm text-gray-500 mb-1">Days Late</p>
                <span class="text-4xl font-bold text-gray-800">{{ stats.days_late }}</span>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-xl flex flex-col items-center text-center">
                <div class="w-12 h-12 flex items-center justify-center bg-blue-500 text-white rounded-full mb-3">
                    <i class="fas fa-user-check"></i>
                </div>
                <p class="text-sm text-gray-500 mb-1">Days Present</p>
                <span class="text-4xl font-bold text-gray-800">{{ stats.days_present }}</span>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-xl flex flex-col items-center text-center">
                <div class="w-12 h-12 flex items-center justify-center bg-blue-500 text-white rounded-full mb-3">
                    <i class="fas fa-user-times"></i>
                </div>
                <p class="text-sm text-gray-500 mb-1">Days Absent</p>
                <span class="text-4xl font-bold text-gray-800">{{ stats.days_absent }}</span>
            </div>
        </div>

        <div class="lg:col-span-1 grid grid-cols-1 gap-6">
            <div class="bg-white p-6 rounded-2xl shadow-xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">Calendar</h3>
                    <span id="calendar-month-year" class="text-sm text-gray-500"></span>
                </div>
                <div class="grid grid-cols-7 text-center text-sm font-semibold text-gray-500 mb-2">
                    <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span>
                </div>
                <div id="calendar-days" class="grid grid-cols-7 gap-1 text-center text-sm"></div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-xl flex flex-col items-center justify-center text-center">
                <p class="text-sm text-gray-500 mb-3">Attendance Rate</p>
                <div class="progress-circle bg-green-50 rounded-full w-28 h-28 flex items-center justify-center">
                    <span class="text-4xl font-bold text-gray-800">{{ stats.attendance_rate }}%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Attendance Table -->
    <div class="lg:col-span-3 bg-white p-6 rounded-2xl shadow-xl mt-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Recent Attendance</h3>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead>
                    <tr class="bg-gray-50">
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Module</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for record in recent_attendance %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ record.date }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ record.time }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ record.module }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm {% if record.status == 'Present' %}text-green-600{% else %}text-red-600{% endif %} font-semibold">{{ record.status }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const calendarDaysEl = document.getElementById('calendar-days');
        const calendarMonthYearEl = document.getElementById('calendar-month-year');
        const today = new Date();
        let currentMonth = today.getMonth();
        let currentYear = today.getFullYear();

        const renderCalendar = (month, year) => {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const firstDayOfWeek = (firstDay.getDay() + 6) % 7;
            const daysInMonth = lastDay.getDate();

            calendarMonthYearEl.textContent = `${lastDay.toLocaleString('default', { month: 'long' })} ${year}`;
            calendarDaysEl.innerHTML = '';

            for (let i = 0; i < firstDayOfWeek; i++) calendarDaysEl.appendChild(document.createElement('span'));
            for (let i = 1; i <= daysInMonth; i++) {
                const dayEl = document.createElement('span');
                dayEl.textContent = i;
                dayEl.classList.add('p-2', 'rounded-full', 'w-8', 'h-8', 'flex', 'items-center', 'justify-center', 'cursor-pointer', 'transition-colors', 'duration-200');
                if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) dayEl.classList.add('bg-blue-500', 'text-white', 'font-bold');
                else dayEl.classList.add('text-gray-700', 'hover:bg-gray-100');
                calendarDaysEl.appendChild(dayEl);
            }
        };
        renderCalendar(currentMonth, currentYear);
    });
</script>

</body>
</html>
